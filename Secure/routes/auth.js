var express = require('express');
var router = express.Router();
var path = require('path');
var db = require('../dbconnector');
var bcrypt = require('bcrypt');
var saltRounds = 10;


router.get('/signup', (req, res) => {
        console.log('signin');
        res.sendFile(path.join(__dirname, '../views', 'inscription.html'));
});

router.post('/signup', (req, res) => {
       //TODO: Implement user registration
// Extract user data from request body
console.log(req.query);
console.log(req);
var { username, password } = req.query;
console.log(username);

// Check if username and password are provided
if (!username || !password) {
        return res.status(400).json({ error: 'Username and password are required' });
}

// Check if user already exists in the database
//TODO: Hash the user password
password = bcrypt.hashSync(password, saltRounds);



// Add the new user to the database
var sql = 'INSERT INTO users (username, password) VALUES (?, ?)';

db.query(sql, [username, password], (err, result) => {
        if (err) {
                console.log('Error registering user');
                return res.status(500).json({ error: 'Error registering user' });
        }
        console.log('User registered successfully');
});

// Redirect or send response indicating successful registration
res.redirect('/signin');
});

router.get('/login', (req, res) => {
        console.log('signup');
        res.sendFile(path.join(__dirname, '../views', 'connexion.html'));
});

router.post('/login', (req, res) => {
        //TODO: Implement user login
});



module.exports = router;