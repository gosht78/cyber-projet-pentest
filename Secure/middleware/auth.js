var express = require('express');
var jwt = require('jsonwebtoken');
var dotenv = require('dotenv');



require('dotenv').config();

process.env.ACCESS_TOKEN_SECRET;
process.env.REFRESH_TOKEN_SECRET;



function generateAccessToken(user) {
        console.log('generateAccessToken');
        console.log(user);
        console.log(process.env.ACCESS_TOKEN_SECRET);
        token = jwt.sign(user, process.env.ACCESS_TOKEN_SECRET,{ expiresIn: '1800s'});
        console.log(token);

        return token;

}

function authenticateToken(req, res, next) {
        console.log('authenticateToken');
        console.log(req.cookies);
        const token = req.cookies.token;
        console.log(token);
        if (token == null) return res.redirect('/auth/login');
        jwt.verify(token, process.env.ACCESS_TOKEN_SECRET, (err, user) => {
                console.log('Verifing Token');
                console.log(err);
                if (err) {
                        console.log('Error verifying token');
                        return res.sendStatus(403);
                }
                
                req.user = user;
                next();
        });
}

module.exports = { generateAccessToken , authenticateToken};