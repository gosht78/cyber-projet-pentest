#!/bin/bash

# Ensure we are running under bash
if [ "$BASH_SOURCE" = "" ]; then
    /bin/bash "$0"
    exit 0
fi

DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
source "$DIR/menus/bash-menu.sh"




#Item handlers
launchSecure(){
        echo "Launching Secure"
        echo -n "Press enter to continue ... "
        read response
        cd Secure/
        ls -l
        setup

        


        return 0
}

launchVulnerable(){
        echo "Launching Vulnerable"
        echo -n "Press enter to continue ... "
        read response
        cd Vulnerable/
        ls -l
        setup
        return 0
}



setup(){
        npm install
        if [ $? -ne 0 ]; then
            echo "Error installing Secure"
            return 1
        fi
        if [ ! -d "node_modules" ]; then
            echo "Error installing Secure"
            return 1
        fi
        if [ ! -f "package.json" ]; then
            echo "Error installing Secure"
            return 1
        fi
       
        npm install -g db-migrate

        if [ $? -ne 0 ]; then
            echo "Error installing Secure"
            return 1
        fi
        db-migrate up

        node app.js
        return 0
}

exitMenu(){
        return 0
}


#Menu items
menuItems=(
    "1. Secure"
    "2. Vulnerable"
    "Q. Exit"
)


#Menu actions
menuActions=(
    "launchSecure"
    "launchVulnerable"
    "exitMenu"
)

## Override some menu defaults
menuTitle="Launch menu"
menuFooter=" Enter=Select, Navigate via Up/Down/First number/letter"
menuWidth=60
menuLeft=25
menuHighlight=$DRAW_COL_RED


################################
## Run Menu
################################
menuInit
menuLoop


exit 0